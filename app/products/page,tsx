import ProductCard from "@/components/ProductCard";
import { supabase } from "@/lib/supabase";

export default async function ProductsPage() {
  // Fetch all products from Supabase
  const { data: products, error } = await supabase
    .from("products")
    .select("*")
    .order("created_at", { ascending: false }); // newest first

  if (error) return <p className="text-center mt-10 text-red-500">{error.message}</p>;
  if (!products || products.length === 0)
    return <p className="text-center mt-10">No products yet.</p>;

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 max-w-6xl mx-auto p-6">
      {products.map((p) => (
        <ProductCard
          key={p.id}
          name={p.name}
          slug={p.slug}
          image={p.image}
          price={Number(p.price)}
          salePrice={Number(p.sale_price)}
          dateAdded={p.created_at}
          salesCount={p.sales_count}
          badge={p.badge ?? undefined}
        />
      ))}
    </div>
  );
}
